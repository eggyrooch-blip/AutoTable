# Base JSON 解析插件

> 一键把接口返回的 JSON / YAML / TSV / 日志数据转换成多维表格结构，自动建表、同步字段并写入数据。

## 为什么值得用

- **自动识别数据格式**：JSON、YAML、TSV、日志文本一键解析，支持反序列化嵌套 JSON 字符串。
- **字段智能推断**：基于样本推断字段类型，支持启用/禁用、重命名和类型切换，实时预览示例值。
- **目标表可视映射**：所有源表在同一面板完成目标表选择，自动生成“源表 → 目标表”摘要。
- **安全执行链路**：同步/写入前自动快照，可撤销；写入时支持“仅写勾选字段”或“写入全部字段”两种策略。
- **黑客风操作日志**：实时显示建表、同步、写入结果，异常信息一目了然。
- **日志折叠与查看模式**：在“最新”与“全部”记录间快速切换，可折叠面板，顶部保留最近成效提示。

## 推荐的操作顺序

1. **输入数据**
   - 粘贴 JSON / YAML / TSV / 日志文本或上传文件。
   - 保持 `自动识别`，点击“解析数据”。
   - 解析失败时查看顶部告警或日志。
2. **整理解析结果**
   - 在字段面板勾选需要写入的字段，调整名称与类型。
   - 解析完成后预览默认折叠，点击“展开预览”进入字段列表；面板顶部显示“已勾选 / 总字段”与样本记录数。若再次“收起预览”，系统会记住该偏好。
   - 如果开启“自动刷新字段名称”，勾选字段后会在写入完成后自动尝试同步目标表标题。
3. **配置执行策略**
   - 在“执行任务”卡片中，为每个源表选择目标表：默认自动创建，也可绑定既有多维表。
   - 选择字段范围：`仅勾选字段` 或 `所有字段`。
   - 若需要自动同步目标字段名称，启用“自动刷新字段名称”。
4. **执行并检查日志**
   - `同步字段名称`：先对齐目标表结构，必要时自动补建缺失表/字段。
   - `写入全部`：按字段范围写入记录，结构不匹配会自动新建新表并生成快照。
   - `撤销上一次变更`：回滚到最新一次执行前的快照。
   - 底部黑色日志面板展示实时反馈，失败原因会高亮显示。

## 本地开发

1. 安装依赖
   ```bash
   npm install
   ```
2. 启动开发服务器
   ```bash
   npm run dev
   ```
   打开 CLI 提示的地址（默认 `http://localhost:5173`），将插件挂载到飞书多维表格测试环境。

## 构建与发布

1. 生产打包
   ```bash
   npm run build
   ```
   构建结果位于 `dist/`。
2. 与团队共享或提交审核运营时，提交 `dist/` 与源代码，并补充必要的上线说明。

## UX 提示

- 输入区 → 执行策略 → 字段预览 → 操作日志，尽量保持这个顺序，让使用者可以自上而下完成任务。
- 说明文字保持一句话，必要时用提示气泡或 placeholder 讲解细节，避免卡片内长段落。
- 在执行按钮附近展示“源表 → 目标表”摘要和字段范围选择，可以减少上下滚动。

## 相关资料

- [多维表格扩展脚本开发指南](https://feishu.feishu.cn/docx/U3wodO5eqome3uxFAC3cl0qanIe)
- [Base Extension Development Guide（英文）](https://lark-technologies.larksuite.com/docx/HvCbdSzXNowzMmxWgXsuB2Ngs7d)

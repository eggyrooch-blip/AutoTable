# Base JSON 解析插件

> 一键将接口返回的 JSON / YAML / TSV / 日志数据解析为多维表格结构，并支持自动建表、字段同步与数据写入。

## 插件亮点功能

1. **智能格式识别与解析**：支持 JSON、YAML、TSV、日志文本等多种数据源，自动检测格式并在解析阶段反序列化嵌套的 JSON 字符串字段。
2. **字段推断与结构预览**：根据样本数据推断字段类型，支持字段启用、重命名、类型切换以及分组浏览，并提供解析日志与告警提示。
3. **目标数据表映射**：每张解析出的源表都可以选择“自动创建”或映射到已有多维表格，顶部摘要实时展示“源表 → 目标表”关系，便于团队协同确认写入策略。
4. **安全的字段同步与数据写入**：
   - `同步字段`：对照目标表结构自动补建缺失表和字段。
   - `写入全部（基于目标表）`：结构一致时追加写入，结构发生变化时自动新建表，自动生成快照支持“撤销上一次变更”。
5. **快照与撤销**：每次同步/写入前都会保存快照，出现错误可一键回滚。

## 快速上手

1. **安装依赖**
   ```bash
   npm install
   ```
2. **本地开发**
   ```bash
   npm run dev
   ```
   在浏览器中打开预览页（通常是 `http://localhost:5173` 或 CLI 给出的地址），将插件脚本挂载到飞书多维表格待测环境。
3. **解析数据**
   - 将 JSON / YAML / TSV / 日志文本粘贴到输入框，或点击“导入文件”。
   - 选择（或保持）`自动识别` 数据格式，点击“解析数据”。
   - 解析完成后，可在字段面板勾选字段、修改名称与类型、查看示例数据。
4. **配置目标数据表**
   - 页面顶部会展示“源表 → 目标表”摘要。
   - 在每个表的“目标数据表”区域，可选择：
     - `自动创建新表`: 默认策略，会根据解析结构自动建表。
     - 已有多维表：从下拉列表中选择，插件会同步字段后写入追加数据。
5. **执行操作**
   - `同步字段`：依据目标映射创建或同步字段结构，可配合“仅追加模式”避免自动建表。
   - `写入全部（基于目标表）`：将所有解析出的记录写入目标表，结构匹配则追加，不匹配时自动新建（追加模式下会拦截并提示）。
   - `撤销上一次变更`：如遇问题可回滚到上次同步/写入前的状态。

## 插件使用说明（分享页文案建议）

### 功能亮点
1. **多格式自动解析**：无需手动选择格式，支持 JSON / YAML / TSV / 日志，自动展开嵌套对象和 JSON 字符串字段。
2. **可视化字段管理**：实时查看字段建议类型、启用开关、示例数据，支持字段分组与筛选。
3. **目标表映射与日志提示**：顶部摘要展示源表与目标表的对应关系，操作日志实时提示创建/追加结果。
4. **安全写入与撤销机制**：同步/写入前自动快照，支持开启“仅追加模式”禁止自动建表，出现异常可一键撤销。
5. **灵活的记录定位**：支持“顶层对象数组”与“单对象”两种结构——若传入单个对象，插件会自动将其视为一条记录；若包含多个数组字段，会分别转化为子表。

### 操作指南
1. 在输入区域粘贴接口返回数据或上传文件，点击“解析数据”。
2. 在左侧字段列表调整字段名称、类型、启用状态。
3. 查看顶部“源表 → 目标表”卡片，确认解析出来的记录总数；对每张源表选择目标多维表（默认自动创建，也可映射到已有数据表）。
4. 点击“同步字段”更新目标表结构——顶部会提示哪些源表映射到哪些目标表、是否处于仅追加模式。
5. 可根据需要开启“仅追加模式”以限制自动建表；如需撤销最近一次写入/同步，使用“撤销上一次变更”。

## 构建与发布

1. 生产打包：
   ```bash
   npm run build
   ```
   生成的 `dist/` 目录即为提交审核或部署所需文件。
2. 提交发布：
   - 将 `dist/` 与源代码一起提交。
   - 按运营流程填写飞书多维表格扩展的上线/共享表单。

## 相关资源
- [多维表格扩展脚本开发指南](https://feishu.feishu.cn/docx/U3wodO5eqome3uxFAC3cl0qanIe)
- [Base Extension Development Guide（英文）](https://lark-technologies.larksuite.com/docx/HvCbdSzXNowzMmxWgXsuB2Ngs7d)
